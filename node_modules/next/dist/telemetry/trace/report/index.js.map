{"version":3,"sources":["../../../../telemetry/trace/report/index.ts"],"sourcesContent":["import { TARGET, SpanId } from '../shared'\nimport reportToConsole from './to-console'\nimport reportToZipkin from './to-zipkin'\nimport reportToJaeger from './to-jaeger'\nimport reportToTelemetry from './to-telemetry'\nimport reportToJson from './to-json'\n\ntype Reporter = {\n  flushAll: () => Promise<void> | void\n  report: (\n    spanName: string,\n    duration: number,\n    timestamp: number,\n    id: SpanId,\n    parentId?: SpanId,\n    attrs?: Object\n  ) => void\n}\n\nclass MultiReporter implements Reporter {\n  private reporters: Reporter[] = []\n\n  constructor(reporters: Reporter[]) {\n    this.reporters = reporters\n  }\n\n  async flushAll() {\n    await Promise.all(this.reporters.map((reporter) => reporter.flushAll()))\n  }\n\n  report(\n    spanName: string,\n    duration: number,\n    timestamp: number,\n    id: SpanId,\n    parentId?: SpanId,\n    attrs?: Object\n  ) {\n    this.reporters.forEach((reporter) =>\n      reporter.report(spanName, duration, timestamp, id, parentId, attrs)\n    )\n  }\n}\n\nconst target =\n  process.env.TRACE_TARGET && process.env.TRACE_TARGET in TARGET\n    ? TARGET[process.env.TRACE_TARGET as TARGET]\n    : TARGET.TELEMETRY\n\nif (process.env.TRACE_TARGET && !target) {\n  console.info(\n    'For TRACE_TARGET, please specify one of: CONSOLE, ZIPKIN, TELEMETRY'\n  )\n}\n\nlet traceTargetReporter: Reporter\n\nif (target === TARGET.CONSOLE) {\n  traceTargetReporter = reportToConsole\n} else if (target === TARGET.ZIPKIN) {\n  traceTargetReporter = reportToZipkin\n} else if (target === TARGET.JAEGER) {\n  traceTargetReporter = reportToJaeger\n} else {\n  traceTargetReporter = reportToTelemetry\n}\n\n// JSON is always reported to allow for diagnostics\nexport const reporter = new MultiReporter([reportToJson, traceTargetReporter])\n"],"names":[],"mappings":";;;;;AAA+B,GAAW,CAAX,OAAW;AACd,GAAc,CAAd,UAAc;AACf,GAAa,CAAb,SAAa;AACb,GAAa,CAAb,SAAa;AACV,GAAgB,CAAhB,YAAgB;AACrB,GAAW,CAAX,OAAW;;;;;;MAc9B,aAAa;gBAGL,SAAqB,CAAE,CAAC;aAF5B,SAAS;aAGV,SAAS,GAAG,SAAS;IAC5B,CAAC;UAEK,QAAQ,GAAG,CAAC;cACV,OAAO,CAAC,GAAG,MAAM,SAAS,CAAC,GAAG,EAAE,QAAQ,GAAK,QAAQ,CAAC,QAAQ;;IACtE,CAAC;IAED,MAAM,CACJ,QAAgB,EAChB,QAAgB,EAChB,SAAiB,EACjB,EAAU,EACV,QAAiB,EACjB,KAAc,EACd,CAAC;aACI,SAAS,CAAC,OAAO,EAAE,QAAQ,GAC9B,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAAE,QAAQ,EAAE,SAAS,EAAE,EAAE,EAAE,QAAQ,EAAE,KAAK;;IAEtE,CAAC;;AAGH,KAAK,CAAC,MAAM,GACV,OAAO,CAAC,GAAG,CAAC,YAAY,IAAI,OAAO,CAAC,GAAG,CAAC,YAAY,IA7CvB,OAAW,UAAX,OAAW,QA8C7B,OAAO,CAAC,GAAG,CAAC,YAAY,IA9CN,OAAW,QA+C7B,SAAS;AAEtB,EAAE,EAAE,OAAO,CAAC,GAAG,CAAC,YAAY,KAAK,MAAM,EAAE,CAAC;IACxC,OAAO,CAAC,IAAI,EACV,mEAAqE;AAEzE,CAAC;AAED,GAAG,CAAC,mBAAmB;AAEvB,EAAE,EAAE,MAAM,KAzDqB,OAAW,QAyDpB,OAAO,EAAE,CAAC;IAC9B,mBAAmB,GAzDO,UAAc;AA0D1C,CAAC,MAAM,EAAE,EAAE,MAAM,KA3Dc,OAAW,QA2Db,MAAM,EAAE,CAAC;IACpC,mBAAmB,GA1DM,SAAa;AA2DxC,CAAC,MAAM,EAAE,EAAE,MAAM,KA7Dc,OAAW,QA6Db,MAAM,EAAE,CAAC;IACpC,mBAAmB,GA3DM,SAAa;AA4DxC,CAAC,MAAM,CAAC;IACN,mBAAmB,GA5DS,YAAgB;AA6D9C,CAAC;AAGM,KAAK,CAAC,QAAQ,GAAG,GAAG,CAAC,aAAa;IA/DhB,OAAW;IA+DqB,mBAAmB;;QAA/D,QAAQ,GAAR,QAAQ"}