{"version":3,"sources":["../../../telemetry/events/build.ts"],"sourcesContent":["const REGEXP_DIRECTORY_DUNDER =\n  /[\\\\/]__[^\\\\/]+(?<![\\\\/]__(?:tests|mocks))__[\\\\/]/i\nconst REGEXP_DIRECTORY_TESTS = /[\\\\/]__(tests|mocks)__[\\\\/]/i\nconst REGEXP_FILE_TEST = /\\.(?:spec|test)\\.[^.]+$/i\n\nconst EVENT_TYPE_CHECK_COMPLETED = 'NEXT_TYPE_CHECK_COMPLETED'\ntype EventTypeCheckCompleted = {\n  durationInSeconds: number\n  typescriptVersion: string | null\n  inputFilesCount?: number\n  totalFilesCount?: number\n  incremental?: boolean\n}\n\nexport function eventTypeCheckCompleted(event: EventTypeCheckCompleted): {\n  eventName: string\n  payload: EventTypeCheckCompleted\n} {\n  return {\n    eventName: EVENT_TYPE_CHECK_COMPLETED,\n    payload: event,\n  }\n}\n\nconst EVENT_LINT_CHECK_COMPLETED = 'NEXT_LINT_CHECK_COMPLETED'\nexport type EventLintCheckCompleted = {\n  durationInSeconds: number\n  eslintVersion: string | null\n  lintedFilesCount?: number\n  lintFix?: boolean\n  buildLint?: boolean\n  nextEslintPluginVersion?: string | null\n  nextEslintPluginErrorsCount?: number\n  nextEslintPluginWarningsCount?: number\n}\n\nexport function eventLintCheckCompleted(event: EventLintCheckCompleted): {\n  eventName: string\n  payload: EventLintCheckCompleted\n} {\n  return {\n    eventName: EVENT_LINT_CHECK_COMPLETED,\n    payload: event,\n  }\n}\n\nconst EVENT_BUILD_COMPLETED = 'NEXT_BUILD_COMPLETED'\ntype EventBuildCompleted = {\n  durationInSeconds: number\n  totalPageCount: number\n  hasDunderPages: boolean\n  hasTestPages: boolean\n}\n\nexport function eventBuildCompleted(\n  pagePaths: string[],\n  event: Omit<\n    EventBuildCompleted,\n    'totalPageCount' | 'hasDunderPages' | 'hasTestPages'\n  >\n): { eventName: string; payload: EventBuildCompleted } {\n  return {\n    eventName: EVENT_BUILD_COMPLETED,\n    payload: {\n      ...event,\n      totalPageCount: pagePaths.length,\n      hasDunderPages: pagePaths.some((path) =>\n        REGEXP_DIRECTORY_DUNDER.test(path)\n      ),\n      hasTestPages: pagePaths.some(\n        (path) =>\n          REGEXP_DIRECTORY_TESTS.test(path) || REGEXP_FILE_TEST.test(path)\n      ),\n    },\n  }\n}\n\nconst EVENT_BUILD_OPTIMIZED = 'NEXT_BUILD_OPTIMIZED'\ntype EventBuildOptimized = {\n  durationInSeconds: number\n  totalPageCount: number\n  staticPageCount: number\n  staticPropsPageCount: number\n  serverPropsPageCount: number\n  ssrPageCount: number\n  hasDunderPages: boolean\n  hasTestPages: boolean\n  hasStatic404: boolean\n  hasReportWebVitals: boolean\n  headersCount: number\n  rewritesCount: number\n  redirectsCount: number\n  headersWithHasCount: number\n  rewritesWithHasCount: number\n  redirectsWithHasCount: number\n}\n\nexport function eventBuildOptimize(\n  pagePaths: string[],\n  event: Omit<\n    EventBuildOptimized,\n    'totalPageCount' | 'hasDunderPages' | 'hasTestPages'\n  >\n): { eventName: string; payload: EventBuildOptimized } {\n  return {\n    eventName: EVENT_BUILD_OPTIMIZED,\n    payload: {\n      ...event,\n      totalPageCount: pagePaths.length,\n      hasDunderPages: pagePaths.some((path) =>\n        REGEXP_DIRECTORY_DUNDER.test(path)\n      ),\n      hasTestPages: pagePaths.some(\n        (path) =>\n          REGEXP_DIRECTORY_TESTS.test(path) || REGEXP_FILE_TEST.test(path)\n      ),\n    },\n  }\n}\n"],"names":[],"mappings":";;;;QAcgB,uBAAuB,GAAvB,uBAAuB;QAsBvB,uBAAuB,GAAvB,uBAAuB;QAkBvB,mBAAmB,GAAnB,mBAAmB;QA2CnB,kBAAkB,GAAlB,kBAAkB;AAjGlC,KAAK,CAAC,uBAAuB;AAE7B,KAAK,CAAC,sBAAsB;AAC5B,KAAK,CAAC,gBAAgB;AAEtB,KAAK,CAAC,0BAA0B,IAAG,yBAA2B;SAS9C,uBAAuB,CAAC,KAA8B,EAGpE,CAAC;;QAEC,SAAS,EAAE,0BAA0B;QACrC,OAAO,EAAE,KAAK;;AAElB,CAAC;AAED,KAAK,CAAC,0BAA0B,IAAG,yBAA2B;SAY9C,uBAAuB,CAAC,KAA8B,EAGpE,CAAC;;QAEC,SAAS,EAAE,0BAA0B;QACrC,OAAO,EAAE,KAAK;;AAElB,CAAC;AAED,KAAK,CAAC,qBAAqB,IAAG,oBAAsB;SAQpC,mBAAmB,CACjC,SAAmB,EACnB,KAGC,EACoD,CAAC;;QAEpD,SAAS,EAAE,qBAAqB;QAChC,OAAO;eACF,KAAK;YACR,cAAc,EAAE,SAAS,CAAC,MAAM;YAChC,cAAc,EAAE,SAAS,CAAC,IAAI,EAAE,IAAI,GAClC,uBAAuB,CAAC,IAAI,CAAC,IAAI;;YAEnC,YAAY,EAAE,SAAS,CAAC,IAAI,EACzB,IAAI,GACH,sBAAsB,CAAC,IAAI,CAAC,IAAI,KAAK,gBAAgB,CAAC,IAAI,CAAC,IAAI;;;;AAIzE,CAAC;AAED,KAAK,CAAC,qBAAqB,IAAG,oBAAsB;SAoBpC,kBAAkB,CAChC,SAAmB,EACnB,KAGC,EACoD,CAAC;;QAEpD,SAAS,EAAE,qBAAqB;QAChC,OAAO;eACF,KAAK;YACR,cAAc,EAAE,SAAS,CAAC,MAAM;YAChC,cAAc,EAAE,SAAS,CAAC,IAAI,EAAE,IAAI,GAClC,uBAAuB,CAAC,IAAI,CAAC,IAAI;;YAEnC,YAAY,EAAE,SAAS,CAAC,IAAI,EACzB,IAAI,GACH,sBAAsB,CAAC,IAAI,CAAC,IAAI,KAAK,gBAAgB,CAAC,IAAI,CAAC,IAAI;;;;AAIzE,CAAC"}