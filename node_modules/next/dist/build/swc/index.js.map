{"version":3,"sources":["../../../build/swc/index.js"],"sourcesContent":["const { loadBinding } = require('@node-rs/helper')\nconst path = require('path')\n\n/**\n * __dirname means load native addon from current dir\n * 'next-swc' is the name of native addon\n * the second arguments was decided by `napi.name` field in `package.json`\n * the third arguments was decided by `name` field in `package.json`\n * `loadBinding` helper will load `next-swc.[PLATFORM].node` from `__dirname` first\n * If failed to load addon, it will fallback to load from `next-swc-[PLATFORM]`\n */\nconst bindings = loadBinding(\n  path.join(__dirname, '../../../native'),\n  'next-swc',\n  '@next/swc'\n)\n\nasync function transform(src, options) {\n  const isModule = typeof src !== 'string'\n  options = options || {}\n\n  if (options?.jsc?.parser) {\n    options.jsc.parser.syntax = options.jsc.parser.syntax ?? 'ecmascript'\n  }\n\n  const { plugin, ...newOptions } = options\n\n  if (plugin) {\n    const m =\n      typeof src === 'string'\n        ? await this.parse(src, options?.jsc?.parser)\n        : src\n    return this.transform(plugin(m), newOptions)\n  }\n\n  return bindings.transform(\n    isModule ? JSON.stringify(src) : src,\n    isModule,\n    toBuffer(newOptions)\n  )\n}\n\nfunction transformSync(src, options) {\n  const isModule = typeof src !== 'string'\n  options = options || {}\n\n  if (options?.jsc?.parser) {\n    options.jsc.parser.syntax = options.jsc.parser.syntax ?? 'ecmascript'\n  }\n\n  const { plugin, ...newOptions } = options\n\n  if (plugin) {\n    const m =\n      typeof src === 'string' ? this.parseSync(src, options?.jsc?.parser) : src\n    return this.transformSync(plugin(m), newOptions)\n  }\n\n  return bindings.transformSync(\n    isModule ? JSON.stringify(src) : src,\n    isModule,\n    toBuffer(newOptions)\n  )\n}\n\nfunction toBuffer(t) {\n  return Buffer.from(JSON.stringify(t))\n}\n\nmodule.exports.transform = transform\nmodule.exports.transformSync = transformSync\n"],"names":[],"mappings":"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"}