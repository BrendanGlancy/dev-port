{"version":3,"sources":["../../../../../../build/webpack/plugins/webpack-conformance-plugin/checks/granular-chunks-conformance.ts"],"sourcesContent":["/* @eslint-disable no-redeclare */\nimport chalk from 'chalk'\nimport {\n  CONFORMANCE_ERROR_PREFIX,\n  CONFORMANCE_WARNING_PREFIX,\n} from '../constants'\nimport {\n  IConformanceTestResult,\n  IConformanceTestStatus,\n  IWebpackConformanceTest,\n} from '../TestInterface'\nimport { deepEqual } from '../utils/utils'\n\nfunction getWarningMessage(modifiedProp: string) {\n  return (\n    `${CONFORMANCE_WARNING_PREFIX}: The splitChunks config has been carefully ` +\n    `crafted to optimize build size and build times. Modifying - ${chalk.bold(\n      modifiedProp\n    )} could result in slower builds and increased code duplication`\n  )\n}\n\nfunction getErrorMessage(message: string) {\n  return (\n    `${CONFORMANCE_ERROR_PREFIX}: The splitChunks config has been carefully ` +\n    `crafted to optimize build size and build times. Please avoid changes to ${chalk.bold(\n      message\n    )}`\n  )\n}\n\n/* @eslint-disable-next-line no-redeclare */\nexport class GranularChunksConformanceCheck implements IWebpackConformanceTest {\n  granularChunksConfig: any\n  constructor(granularChunksConfig: any) {\n    this.granularChunksConfig = granularChunksConfig\n  }\n\n  public buildStared(options: any): IConformanceTestResult {\n    const userSplitChunks = options.optimization.splitChunks\n    const warnings = []\n    const errors = []\n\n    if (\n      userSplitChunks.maxInitialRequests !==\n      this.granularChunksConfig.maxInitialRequests\n    ) {\n      warnings.push('splitChunks.maxInitialRequests')\n    }\n\n    if (userSplitChunks.minSize !== this.granularChunksConfig.minSize) {\n      warnings.push('splitChunks.minSize')\n    }\n\n    const userCacheGroup = userSplitChunks.cacheGroups\n    const originalCacheGroup = this.granularChunksConfig.cacheGroups\n\n    if (userCacheGroup.vendors !== false) {\n      errors.push('splitChunks.cacheGroups.vendors')\n    }\n\n    if (!deepEqual(userCacheGroup.framework, originalCacheGroup.framework)) {\n      errors.push('splitChunks.cacheGroups.framework')\n    }\n\n    if (!deepEqual(userCacheGroup.lib, originalCacheGroup.lib)) {\n      errors.push('splitChunks.cacheGroups.lib')\n    }\n\n    if (!deepEqual(userCacheGroup.commons, originalCacheGroup.commons)) {\n      errors.push('splitChunks.cacheGroups.commons')\n    }\n\n    if (!deepEqual(userCacheGroup.shared, originalCacheGroup.shared)) {\n      errors.push('splitChunks.cacheGroups.shared')\n    }\n\n    if (!warnings.length && !errors.length) {\n      return {\n        result: IConformanceTestStatus.SUCCESS,\n      }\n    }\n\n    const failedResult: IConformanceTestResult = {\n      result: IConformanceTestStatus.FAILED,\n    }\n\n    if (warnings.length) {\n      failedResult.warnings = warnings.map((warning) => ({\n        message: getWarningMessage(warning),\n      }))\n    }\n\n    if (errors.length) {\n      failedResult.warnings = errors.map((error) => ({\n        message: getErrorMessage(error),\n      }))\n    }\n\n    return failedResult\n  }\n}\n"],"names":[],"mappings":";;;;AACkB,GAAO,CAAP,MAAO;AAIlB,GAAc,CAAd,UAAc;AAKd,GAAkB,CAAlB,cAAkB;AACC,GAAgB,CAAhB,MAAgB;;;;;;SAEjC,iBAAiB,CAAC,YAAoB,EAAE,CAAC;cAR3C,UAAc,4BAUa,4CAA4C,KACzE,4DAA4D,EAf/C,MAAO,SAegD,IAAI,CACvE,YAAY,EACZ,6DAA6D;AAEnE,CAAC;SAEQ,eAAe,CAAC,OAAe,EAAE,CAAC;cAjBpC,UAAc,0BAmBW,4CAA4C,KACvE,wEAAwE,EAxB3D,MAAO,SAwB4D,IAAI,CACnF,OAAO;AAGb,CAAC;MAGY,8BAA8B;gBAE7B,oBAAyB,CAAE,CAAC;aACjC,oBAAoB,GAAG,oBAAoB;IAClD,CAAC;IAEM,WAAW,CAAC,OAAY,EAA0B,CAAC;QACxD,KAAK,CAAC,eAAe,GAAG,OAAO,CAAC,YAAY,CAAC,WAAW;QACxD,KAAK,CAAC,QAAQ;QACd,KAAK,CAAC,MAAM;QAEZ,EAAE,EACA,eAAe,CAAC,kBAAkB,UAC7B,oBAAoB,CAAC,kBAAkB,EAC5C,CAAC;YACD,QAAQ,CAAC,IAAI,EAAC,8BAAgC;QAChD,CAAC;QAED,EAAE,EAAE,eAAe,CAAC,OAAO,UAAU,oBAAoB,CAAC,OAAO,EAAE,CAAC;YAClE,QAAQ,CAAC,IAAI,EAAC,mBAAqB;QACrC,CAAC;QAED,KAAK,CAAC,cAAc,GAAG,eAAe,CAAC,WAAW;QAClD,KAAK,CAAC,kBAAkB,QAAQ,oBAAoB,CAAC,WAAW;QAEhE,EAAE,EAAE,cAAc,CAAC,OAAO,KAAK,KAAK,EAAE,CAAC;YACrC,MAAM,CAAC,IAAI,EAAC,+BAAiC;QAC/C,CAAC;QAED,EAAE,OAlDoB,MAAgB,YAkDvB,cAAc,CAAC,SAAS,EAAE,kBAAkB,CAAC,SAAS,GAAG,CAAC;YACvE,MAAM,CAAC,IAAI,EAAC,iCAAmC;QACjD,CAAC;QAED,EAAE,OAtDoB,MAAgB,YAsDvB,cAAc,CAAC,GAAG,EAAE,kBAAkB,CAAC,GAAG,GAAG,CAAC;YAC3D,MAAM,CAAC,IAAI,EAAC,2BAA6B;QAC3C,CAAC;QAED,EAAE,OA1DoB,MAAgB,YA0DvB,cAAc,CAAC,OAAO,EAAE,kBAAkB,CAAC,OAAO,GAAG,CAAC;YACnE,MAAM,CAAC,IAAI,EAAC,+BAAiC;QAC/C,CAAC;QAED,EAAE,OA9DoB,MAAgB,YA8DvB,cAAc,CAAC,MAAM,EAAE,kBAAkB,CAAC,MAAM,GAAG,CAAC;YACjE,MAAM,CAAC,IAAI,EAAC,8BAAgC;QAC9C,CAAC;QAED,EAAE,GAAG,QAAQ,CAAC,MAAM,KAAK,MAAM,CAAC,MAAM,EAAE,CAAC;;gBAErC,MAAM,EArEP,cAAkB,wBAqEc,OAAO;;QAE1C,CAAC;QAED,KAAK,CAAC,YAAY;YAChB,MAAM,EA1EL,cAAkB,wBA0EY,MAAM;;QAGvC,EAAE,EAAE,QAAQ,CAAC,MAAM,EAAE,CAAC;YACpB,YAAY,CAAC,QAAQ,GAAG,QAAQ,CAAC,GAAG,EAAE,OAAO;oBAC3C,OAAO,EAAE,iBAAiB,CAAC,OAAO;;;QAEtC,CAAC;QAED,EAAE,EAAE,MAAM,CAAC,MAAM,EAAE,CAAC;YAClB,YAAY,CAAC,QAAQ,GAAG,MAAM,CAAC,GAAG,EAAE,KAAK;oBACvC,OAAO,EAAE,eAAe,CAAC,KAAK;;;QAElC,CAAC;eAEM,YAAY;IACrB,CAAC;;QApEU,8BAA8B,GAA9B,8BAA8B"}