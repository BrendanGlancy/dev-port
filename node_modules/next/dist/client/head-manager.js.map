{"version":3,"sources":["../../client/head-manager.ts"],"sourcesContent":["export const DOMAttributeNames: Record<string, string> = {\n  acceptCharset: 'accept-charset',\n  className: 'class',\n  htmlFor: 'for',\n  httpEquiv: 'http-equiv',\n  noModule: 'noModule',\n}\n\nfunction reactElementToDOM({ type, props }: JSX.Element): HTMLElement {\n  const el: HTMLElement = document.createElement(type)\n  for (const p in props) {\n    if (!props.hasOwnProperty(p)) continue\n    if (p === 'children' || p === 'dangerouslySetInnerHTML') continue\n\n    // we don't render undefined props to the DOM\n    if (props[p] === undefined) continue\n\n    const attr = DOMAttributeNames[p] || p.toLowerCase()\n    if (\n      type === 'script' &&\n      (attr === 'async' || attr === 'defer' || attr === 'noModule')\n    ) {\n      ;(el as HTMLScriptElement)[attr] = !!props[p]\n    } else {\n      el.setAttribute(attr, props[p])\n    }\n  }\n\n  const { children, dangerouslySetInnerHTML } = props\n  if (dangerouslySetInnerHTML) {\n    el.innerHTML = dangerouslySetInnerHTML.__html || ''\n  } else if (children) {\n    el.textContent =\n      typeof children === 'string'\n        ? children\n        : Array.isArray(children)\n        ? children.join('')\n        : ''\n  }\n  return el\n}\n\nfunction updateElements(type: string, components: JSX.Element[]): void {\n  const headEl = document.getElementsByTagName('head')[0]\n  const headCountEl: HTMLMetaElement = headEl.querySelector(\n    'meta[name=next-head-count]'\n  ) as HTMLMetaElement\n  if (process.env.NODE_ENV !== 'production') {\n    if (!headCountEl) {\n      console.error(\n        'Warning: next-head-count is missing. https://nextjs.org/docs/messages/next-head-count-missing'\n      )\n      return\n    }\n  }\n\n  const headCount = Number(headCountEl.content)\n  const oldTags: Element[] = []\n\n  for (\n    let i = 0, j = headCountEl.previousElementSibling;\n    i < headCount;\n    i++, j = j!.previousElementSibling\n  ) {\n    if (j!.tagName.toLowerCase() === type) {\n      oldTags.push(j!)\n    }\n  }\n  const newTags = (components.map(reactElementToDOM) as HTMLElement[]).filter(\n    (newTag) => {\n      for (let k = 0, len = oldTags.length; k < len; k++) {\n        const oldTag = oldTags[k]\n        if (oldTag.isEqualNode(newTag)) {\n          oldTags.splice(k, 1)\n          return false\n        }\n      }\n      return true\n    }\n  )\n\n  oldTags.forEach((t) => t.parentNode!.removeChild(t))\n  newTags.forEach((t) => headEl.insertBefore(t, headCountEl))\n  headCountEl.content = (headCount - oldTags.length + newTags.length).toString()\n}\n\nexport default function initHeadManager(): {\n  mountedInstances: Set<unknown>\n  updateHead: (head: JSX.Element[]) => void\n} {\n  let updatePromise: Promise<void> | null = null\n\n  return {\n    mountedInstances: new Set(),\n    updateHead: (head: JSX.Element[]) => {\n      const promise = (updatePromise = Promise.resolve().then(() => {\n        if (promise !== updatePromise) return\n\n        updatePromise = null\n        const tags: Record<string, JSX.Element[]> = {}\n\n        head.forEach((h) => {\n          if (\n            // If the font tag is loaded only on client navigation\n            // it won't be inlined. In this case revert to the original behavior\n            h.type === 'link' &&\n            h.props['data-optimized-fonts'] &&\n            !document.querySelector(\n              `style[data-href=\"${h.props['data-href']}\"]`\n            )\n          ) {\n            h.props.href = h.props['data-href']\n            h.props['data-href'] = undefined\n          }\n          const components = tags[h.type] || []\n          components.push(h)\n          tags[h.type] = components\n        })\n\n        const titleComponent = tags.title ? tags.title[0] : null\n        let title = ''\n        if (titleComponent) {\n          const { children } = titleComponent.props\n          title =\n            typeof children === 'string'\n              ? children\n              : Array.isArray(children)\n              ? children.join('')\n              : ''\n        }\n        if (title !== document.title) document.title = title\n        ;['meta', 'base', 'link', 'style', 'script'].forEach((type) => {\n          updateElements(type, tags[type] || [])\n        })\n      }))\n    },\n  }\n}\n"],"names":[],"mappings":"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"}