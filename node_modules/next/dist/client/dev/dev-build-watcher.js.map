{"version":3,"sources":["../../../client/dev/dev-build-watcher.js"],"sourcesContent":["import { addMessageListener } from './error-overlay/eventsource'\n\nexport default function initializeBuildWatcher(toggleCallback) {\n  const shadowHost = document.createElement('div')\n  shadowHost.id = '__next-build-watcher'\n  // Make sure container is fixed and on a high zIndex so it shows\n  shadowHost.style.position = 'fixed'\n  shadowHost.style.bottom = '10px'\n  shadowHost.style.right = '20px'\n  shadowHost.style.width = 0\n  shadowHost.style.height = 0\n  shadowHost.style.zIndex = 99999\n  document.body.appendChild(shadowHost)\n\n  let shadowRoot\n  let prefix = ''\n\n  if (shadowHost.attachShadow) {\n    shadowRoot = shadowHost.attachShadow({ mode: 'open' })\n  } else {\n    // If attachShadow is undefined then the browser does not support\n    // the Shadow DOM, we need to prefix all the names so there\n    // will be no conflicts\n    shadowRoot = shadowHost\n    prefix = '__next-build-watcher-'\n  }\n\n  // Container\n  const container = createContainer(prefix)\n  shadowRoot.appendChild(container)\n\n  // CSS\n  const css = createCss(prefix)\n  shadowRoot.appendChild(css)\n\n  // State\n  let isVisible = false\n  let isBuilding = false\n  let timeoutId = null\n\n  // Handle events\n\n  addMessageListener((event) => {\n    // This is the heartbeat event\n    if (event.data === '\\uD83D\\uDC93') {\n      return\n    }\n\n    try {\n      handleMessage(event)\n    } catch {}\n  })\n\n  function handleMessage(event) {\n    const obj =\n      typeof event === 'string' ? { action: event } : JSON.parse(event.data)\n\n    // eslint-disable-next-line default-case\n    switch (obj.action) {\n      case 'building':\n        timeoutId && clearTimeout(timeoutId)\n        isVisible = true\n        isBuilding = true\n        updateContainer()\n        break\n      case 'built':\n      case 'sync':\n        isBuilding = false\n        // Wait for the fade out transition to complete\n        timeoutId = setTimeout(() => {\n          isVisible = false\n          updateContainer()\n        }, 100)\n        updateContainer()\n        break\n    }\n  }\n\n  toggleCallback(handleMessage)\n\n  function updateContainer() {\n    if (isBuilding) {\n      container.classList.add(`${prefix}building`)\n    } else {\n      container.classList.remove(`${prefix}building`)\n    }\n\n    if (isVisible) {\n      container.classList.add(`${prefix}visible`)\n    } else {\n      container.classList.remove(`${prefix}visible`)\n    }\n  }\n}\n\nfunction createContainer(prefix) {\n  const container = document.createElement('div')\n  container.id = `${prefix}container`\n  container.innerHTML = `\n    <div id=\"${prefix}icon-wrapper\">\n      <svg viewBox=\"0 0 226 200\">\n        <defs>\n          <linearGradient\n            x1=\"114.720775%\"\n            y1=\"181.283245%\"\n            x2=\"39.5399306%\"\n            y2=\"100%\"\n            id=\"${prefix}linear-gradient\"\n          >\n            <stop stop-color=\"#000000\" offset=\"0%\" />\n            <stop stop-color=\"#FFFFFF\" offset=\"100%\" />\n          </linearGradient>\n        </defs>\n        <g id=\"${prefix}icon-group\" fill=\"none\" stroke=\"url(#${prefix}linear-gradient)\" stroke-width=\"18\">\n          <path d=\"M113,5.08219117 L4.28393801,197.5 L221.716062,197.5 L113,5.08219117 Z\" />\n        </g>\n      </svg>\n    </div>\n  `\n\n  return container\n}\n\nfunction createCss(prefix) {\n  const css = document.createElement('style')\n  css.textContent = `\n    #${prefix}container {\n      position: absolute;\n      bottom: 10px;\n      right: 30px;\n\n      border-radius: 3px;\n      background: #000;\n      color: #fff;\n      font: initial;\n      cursor: initial;\n      letter-spacing: initial;\n      text-shadow: initial;\n      text-transform: initial;\n      visibility: initial;\n\n      padding: 7px 10px 8px 10px;\n      align-items: center;\n      box-shadow: 0 11px 40px 0 rgba(0, 0, 0, 0.25), 0 2px 10px 0 rgba(0, 0, 0, 0.12);\n\n      display: none;\n      opacity: 0;\n      transition: opacity 0.1s ease, bottom 0.1s ease;\n      animation: ${prefix}fade-in 0.1s ease-in-out;\n    }\n\n    #${prefix}container.${prefix}visible {\n      display: flex;\n    }\n\n    #${prefix}container.${prefix}building {\n      bottom: 20px;\n      opacity: 1;\n    }\n\n    #${prefix}icon-wrapper {\n      width: 16px;\n      height: 16px;\n    }\n\n    #${prefix}icon-wrapper > svg {\n      width: 100%;\n      height: 100%;\n    }\n\n    #${prefix}icon-group {\n      animation: ${prefix}strokedash 1s ease-in-out both infinite;\n    }\n\n    @keyframes ${prefix}fade-in {\n      from {\n        bottom: 10px;\n        opacity: 0;\n      }\n      to {\n        bottom: 20px;\n        opacity: 1;\n      }\n    }\n\n    @keyframes ${prefix}strokedash {\n      0% {\n        stroke-dasharray: 0 226;\n      }\n      80%,\n      100% {\n        stroke-dasharray: 659 226;\n      }\n    }\n  `\n\n  return css\n}\n"],"names":[],"mappings":";;;;kBAEwB,sBAAsB;AAFX,GAA6B,CAA7B,YAA6B;SAExC,sBAAsB,CAAC,cAAc,EAAE,CAAC;IAC9D,KAAK,CAAC,UAAU,GAAG,QAAQ,CAAC,aAAa,EAAC,GAAK;IAC/C,UAAU,CAAC,EAAE,IAAG,oBAAsB;IACtC,EAAgE,AAAhE,8DAAgE;IAChE,UAAU,CAAC,KAAK,CAAC,QAAQ,IAAG,KAAO;IACnC,UAAU,CAAC,KAAK,CAAC,MAAM,IAAG,IAAM;IAChC,UAAU,CAAC,KAAK,CAAC,KAAK,IAAG,IAAM;IAC/B,UAAU,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC;IAC1B,UAAU,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC;IAC3B,UAAU,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK;IAC/B,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU;IAEpC,GAAG,CAAC,UAAU;IACd,GAAG,CAAC,MAAM;IAEV,EAAE,EAAE,UAAU,CAAC,YAAY,EAAE,CAAC;QAC5B,UAAU,GAAG,UAAU,CAAC,YAAY;YAAG,IAAI,GAAE,IAAM;;IACrD,CAAC,MAAM,CAAC;QACN,EAAiE,AAAjE,+DAAiE;QACjE,EAA2D,AAA3D,yDAA2D;QAC3D,EAAuB,AAAvB,qBAAuB;QACvB,UAAU,GAAG,UAAU;QACvB,MAAM,IAAG,qBAAuB;IAClC,CAAC;IAED,EAAY,AAAZ,UAAY;IACZ,KAAK,CAAC,SAAS,GAAG,eAAe,CAAC,MAAM;IACxC,UAAU,CAAC,WAAW,CAAC,SAAS;IAEhC,EAAM,AAAN,IAAM;IACN,KAAK,CAAC,GAAG,GAAG,SAAS,CAAC,MAAM;IAC5B,UAAU,CAAC,WAAW,CAAC,GAAG;IAE1B,EAAQ,AAAR,MAAQ;IACR,GAAG,CAAC,SAAS,GAAG,KAAK;IACrB,GAAG,CAAC,UAAU,GAAG,KAAK;IACtB,GAAG,CAAC,SAAS,GAAG,IAAI;IAEpB,EAAgB,AAAhB,cAAgB;QAxCiB,YAA6B,sBA0C1C,KAAK,GAAK,CAAC;QAC7B,EAA8B,AAA9B,4BAA8B;QAC9B,EAAE,EAAE,KAAK,CAAC,IAAI,MAAK,YAAc,GAAE,CAAC;;QAEpC,CAAC;YAEG,CAAC;YACH,aAAa,CAAC,KAAK;QACrB,CAAC,WAAO,CAAC;QAAA,CAAC;IACZ,CAAC;aAEQ,aAAa,CAAC,KAAK,EAAE,CAAC;QAC7B,KAAK,CAAC,GAAG,UACA,KAAK,MAAK,MAAQ;YAAK,MAAM,EAAE,KAAK;YAAK,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI;QAEvE,EAAwC,AAAxC,sCAAwC;eAChC,GAAG,CAAC,MAAM;kBACX,QAAU;gBACb,SAAS,IAAI,YAAY,CAAC,SAAS;gBACnC,SAAS,GAAG,IAAI;gBAChB,UAAU,GAAG,IAAI;gBACjB,eAAe;;kBAEZ,KAAO;kBACP,IAAM;gBACT,UAAU,GAAG,KAAK;gBAClB,EAA+C,AAA/C,6CAA+C;gBAC/C,SAAS,GAAG,UAAU,KAAO,CAAC;oBAC5B,SAAS,GAAG,KAAK;oBACjB,eAAe;gBACjB,CAAC,EAAE,GAAG;gBACN,eAAe;;;IAGrB,CAAC;IAED,cAAc,CAAC,aAAa;aAEnB,eAAe,GAAG,CAAC;QAC1B,EAAE,EAAE,UAAU,EAAE,CAAC;YACf,SAAS,CAAC,SAAS,CAAC,GAAG,IAAI,MAAM,CAAC,QAAQ;QAC5C,CAAC,MAAM,CAAC;YACN,SAAS,CAAC,SAAS,CAAC,MAAM,IAAI,MAAM,CAAC,QAAQ;QAC/C,CAAC;QAED,EAAE,EAAE,SAAS,EAAE,CAAC;YACd,SAAS,CAAC,SAAS,CAAC,GAAG,IAAI,MAAM,CAAC,OAAO;QAC3C,CAAC,MAAM,CAAC;YACN,SAAS,CAAC,SAAS,CAAC,MAAM,IAAI,MAAM,CAAC,OAAO;QAC9C,CAAC;IACH,CAAC;AACH,CAAC;SAEQ,eAAe,CAAC,MAAM,EAAE,CAAC;IAChC,KAAK,CAAC,SAAS,GAAG,QAAQ,CAAC,aAAa,EAAC,GAAK;IAC9C,SAAS,CAAC,EAAE,MAAM,MAAM,CAAC,SAAS;IAClC,SAAS,CAAC,SAAS,IAAI,cACZ,EAAE,MAAM,CAAC,uNAQN,EAAE,MAAM,CAAC,sMAMV,EAAE,MAAM,CAAC,qCAAqC,EAAE,MAAM,CAAC,yKAKpE;WAEO,SAAS;AAClB,CAAC;SAEQ,SAAS,CAAC,MAAM,EAAE,CAAC;IAC1B,KAAK,CAAC,GAAG,GAAG,QAAQ,CAAC,aAAa,EAAC,KAAO;IAC1C,GAAG,CAAC,WAAW,IAAI,MAChB,EAAE,MAAM,CAAC,yjBAsBG,EAAE,MAAM,CAAC,sCAGrB,EAAE,MAAM,CAAC,UAAU,EAAE,MAAM,CAAC,2CAI5B,EAAE,MAAM,CAAC,UAAU,EAAE,MAAM,CAAC,6DAK5B,EAAE,MAAM,CAAC,kEAKT,EAAE,MAAM,CAAC,wEAKT,EAAE,MAAM,CAAC,8BACG,EAAE,MAAM,CAAC,+DAGX,EAAE,MAAM,CAAC,4JAWT,EAAE,MAAM,CAAC,4IAStB;WAEO,GAAG;AACZ,CAAC"}