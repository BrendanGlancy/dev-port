{"version":3,"sources":["../../../../client/dev/error-overlay/eventsource.js"],"sourcesContent":["const eventCallbacks = []\n\nfunction EventSourceWrapper(options) {\n  var source\n  var lastActivity = new Date()\n  var listeners = []\n\n  if (!options.timeout) {\n    options.timeout = 20 * 1000\n  }\n\n  init()\n  var timer = setInterval(function () {\n    if (new Date() - lastActivity > options.timeout) {\n      handleDisconnect()\n    }\n  }, options.timeout / 2)\n\n  function init() {\n    source = new window.EventSource(options.path)\n    source.onopen = handleOnline\n    source.onerror = handleDisconnect\n    source.onmessage = handleMessage\n  }\n\n  function handleOnline() {\n    if (options.log) console.log('[HMR] connected')\n    lastActivity = new Date()\n  }\n\n  function handleMessage(event) {\n    lastActivity = new Date()\n    for (var i = 0; i < listeners.length; i++) {\n      listeners[i](event)\n    }\n\n    eventCallbacks.forEach((cb) => {\n      if (!cb.unfiltered && event.data.indexOf('action') === -1) return\n      cb(event)\n    })\n  }\n\n  function handleDisconnect() {\n    clearInterval(timer)\n    source.close()\n    setTimeout(init, options.timeout)\n  }\n\n  return {\n    close: () => {\n      clearInterval(timer)\n      source.close()\n    },\n    addMessageListener: function (fn) {\n      listeners.push(fn)\n    },\n  }\n}\n\nexport function addMessageListener(cb) {\n  eventCallbacks.push(cb)\n}\n\nexport function getEventSourceWrapper(options) {\n  return EventSourceWrapper(options)\n}\n"],"names":[],"mappings":";;;;QA2DgB,kBAAkB,GAAlB,kBAAkB;QAIlB,qBAAqB,GAArB,qBAAqB;AA/DrC,KAAK,CAAC,cAAc;SAEX,kBAAkB,CAAC,OAAO,EAAE,CAAC;IACpC,GAAG,CAAC,MAAM;IACV,GAAG,CAAC,YAAY,GAAG,GAAG,CAAC,IAAI;IAC3B,GAAG,CAAC,SAAS;IAEb,EAAE,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;QACrB,OAAO,CAAC,OAAO,GAAG,EAAE,GAAG,IAAI;IAC7B,CAAC;IAED,IAAI;IACJ,GAAG,CAAC,KAAK,GAAG,WAAW,YAAa,CAAC;QACnC,EAAE,EAAE,GAAG,CAAC,IAAI,KAAK,YAAY,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;YAChD,gBAAgB;QAClB,CAAC;IACH,CAAC,EAAE,OAAO,CAAC,OAAO,GAAG,CAAC;aAEb,IAAI,GAAG,CAAC;QACf,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI;QAC5C,MAAM,CAAC,MAAM,GAAG,YAAY;QAC5B,MAAM,CAAC,OAAO,GAAG,gBAAgB;QACjC,MAAM,CAAC,SAAS,GAAG,aAAa;IAClC,CAAC;aAEQ,YAAY,GAAG,CAAC;QACvB,EAAE,EAAE,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,GAAG,EAAC,eAAiB;QAC9C,YAAY,GAAG,GAAG,CAAC,IAAI;IACzB,CAAC;aAEQ,aAAa,CAAC,KAAK,EAAE,CAAC;QAC7B,YAAY,GAAG,GAAG,CAAC,IAAI;YAClB,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,MAAM,EAAE,CAAC,GAAI,CAAC;YAC1C,SAAS,CAAC,CAAC,EAAE,KAAK;QACpB,CAAC;QAED,cAAc,CAAC,OAAO,EAAE,EAAE,GAAK,CAAC;YAC9B,EAAE,GAAG,EAAE,CAAC,UAAU,IAAI,KAAK,CAAC,IAAI,CAAC,OAAO,EAAC,MAAQ,QAAO,CAAC;YACzD,EAAE,CAAC,KAAK;QACV,CAAC;IACH,CAAC;aAEQ,gBAAgB,GAAG,CAAC;QAC3B,aAAa,CAAC,KAAK;QACnB,MAAM,CAAC,KAAK;QACZ,UAAU,CAAC,IAAI,EAAE,OAAO,CAAC,OAAO;IAClC,CAAC;;QAGC,KAAK,MAAQ,CAAC;YACZ,aAAa,CAAC,KAAK;YACnB,MAAM,CAAC,KAAK;QACd,CAAC;QACD,kBAAkB,WAAY,EAAE,EAAE,CAAC;YACjC,SAAS,CAAC,IAAI,CAAC,EAAE;QACnB,CAAC;;AAEL,CAAC;SAEe,kBAAkB,CAAC,EAAE,EAAE,CAAC;IACtC,cAAc,CAAC,IAAI,CAAC,EAAE;AACxB,CAAC;SAEe,qBAAqB,CAAC,OAAO,EAAE,CAAC;WACvC,kBAAkB,CAAC,OAAO;AACnC,CAAC"}