{"version":3,"sources":["../../../lib/typescript/diagnosticFormatter.ts"],"sourcesContent":["import { codeFrameColumns } from 'next/dist/compiled/babel/code-frame'\nimport chalk from 'chalk'\nimport path from 'path'\n\n// eslint typescript has a bug with TS enums\n/* eslint-disable no-shadow */\nexport enum DiagnosticCategory {\n  Warning = 0,\n  Error = 1,\n  Suggestion = 2,\n  Message = 3,\n}\n\nexport async function getFormattedDiagnostic(\n  ts: typeof import('typescript'),\n  baseDir: string,\n  diagnostic: import('typescript').Diagnostic\n): Promise<string> {\n  let message = ''\n\n  const reason = ts.flattenDiagnosticMessageText(diagnostic.messageText, '\\n')\n  const category = diagnostic.category\n  switch (category) {\n    // Warning\n    case DiagnosticCategory.Warning: {\n      message += chalk.yellow.bold('Type warning') + ': '\n      break\n    }\n    // Error\n    case DiagnosticCategory.Error: {\n      message += chalk.red.bold('Type error') + ': '\n      break\n    }\n    // 2 = Suggestion, 3 = Message\n    case DiagnosticCategory.Suggestion:\n    case DiagnosticCategory.Message:\n    default: {\n      message += chalk.cyan.bold(category === 2 ? 'Suggestion' : 'Info') + ': '\n      break\n    }\n  }\n  message += reason + '\\n'\n\n  if (diagnostic.file) {\n    const pos = diagnostic.file.getLineAndCharacterOfPosition(diagnostic.start!)\n    const line = pos.line + 1\n    const character = pos.character + 1\n\n    let fileName = path.posix.normalize(\n      path.relative(baseDir, diagnostic.file.fileName).replace(/\\\\/g, '/')\n    )\n    if (!fileName.startsWith('.')) {\n      fileName = './' + fileName\n    }\n\n    message =\n      chalk.cyan(fileName) +\n      ':' +\n      chalk.yellow(line.toString()) +\n      ':' +\n      chalk.yellow(character.toString()) +\n      '\\n' +\n      message\n\n    message +=\n      '\\n' +\n      codeFrameColumns(\n        diagnostic.file.getFullText(diagnostic.file.getSourceFile()),\n        {\n          start: { line: line, column: character },\n        },\n        { forceColor: true }\n      )\n  }\n\n  return message\n}\n"],"names":[],"mappings":";;;;QAasB,sBAAsB,GAAtB,sBAAsB;;AAbX,GAAqC,CAArC,UAAqC;AACpD,GAAO,CAAP,MAAO;AACR,GAAM,CAAN,KAAM;;;;;;;;UAIX,mBAAkB;IAAlB,mBAAkB,CAAlB,mBAAkB,EAC5B,OAAO,KAAG,CAAC,KAAX,OAAO;IADG,mBAAkB,CAAlB,mBAAkB,EAE5B,KAAK,KAAG,CAAC,KAAT,KAAK;IAFK,mBAAkB,CAAlB,mBAAkB,EAG5B,UAAU,KAAG,CAAC,KAAd,UAAU;IAHA,mBAAkB,CAAlB,mBAAkB,EAI5B,OAAO,KAAG,CAAC,KAAX,OAAO;GAJG,kBAAkB,kCAAlB,kBAAkB;;eAOR,sBAAsB,CAC1C,EAA+B,EAC/B,OAAe,EACf,UAA2C,EAC1B,CAAC;IAClB,GAAG,CAAC,OAAO;IAEX,KAAK,CAAC,MAAM,GAAG,EAAE,CAAC,4BAA4B,CAAC,UAAU,CAAC,WAAW,GAAE,EAAI;IAC3E,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC,QAAQ;WAC5B,QAAQ;QACd,EAAU,AAAV,QAAU;aACL,kBAAkB,CAAC,OAAO;YAAE,CAAC;gBAChC,OAAO,IAxBK,MAAO,SAwBF,MAAM,CAAC,IAAI,EAAC,YAAc,MAAI,EAAI;;YAErD,CAAC;QACD,EAAQ,AAAR,MAAQ;aACH,kBAAkB,CAAC,KAAK;YAAE,CAAC;gBAC9B,OAAO,IA7BK,MAAO,SA6BF,GAAG,CAAC,IAAI,EAAC,UAAY,MAAI,EAAI;;YAEhD,CAAC;QACD,EAA8B,AAA9B,4BAA8B;aACzB,kBAAkB,CAAC,UAAU;aAC7B,kBAAkB,CAAC,OAAO;;YACtB,CAAC;gBACR,OAAO,IApCK,MAAO,SAoCF,IAAI,CAAC,IAAI,CAAC,QAAQ,KAAK,CAAC,IAAG,UAAY,KAAG,IAAM,MAAI,EAAI;;YAE3E,CAAC;;IAEH,OAAO,IAAI,MAAM,IAAG,EAAI;IAExB,EAAE,EAAE,UAAU,CAAC,IAAI,EAAE,CAAC;QACpB,KAAK,CAAC,GAAG,GAAG,UAAU,CAAC,IAAI,CAAC,6BAA6B,CAAC,UAAU,CAAC,KAAK;QAC1E,KAAK,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,GAAG,CAAC;QACzB,KAAK,CAAC,SAAS,GAAG,GAAG,CAAC,SAAS,GAAG,CAAC;QAEnC,GAAG,CAAC,QAAQ,GA9CC,KAAM,SA8CC,KAAK,CAAC,SAAS,CA9CtB,KAAM,SA+CZ,QAAQ,CAAC,OAAO,EAAE,UAAU,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,SAAQ,CAAG;QAErE,EAAE,GAAG,QAAQ,CAAC,UAAU,EAAC,CAAG,IAAG,CAAC;YAC9B,QAAQ,IAAG,EAAI,IAAG,QAAQ;QAC5B,CAAC;QAED,OAAO,GAtDO,MAAO,SAuDb,IAAI,CAAC,QAAQ,KACnB,CAAG,IAxDS,MAAO,SAyDb,MAAM,CAAC,IAAI,CAAC,QAAQ,OAC1B,CAAG,IA1DS,MAAO,SA2Db,MAAM,CAAC,SAAS,CAAC,QAAQ,OAC/B,EAAI,IACJ,OAAO;QAET,OAAO,KACL,EAAI,QAjEuB,UAAqC,mBAmE9D,UAAU,CAAC,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,aAAa;YAEvD,KAAK;gBAAI,IAAI,EAAE,IAAI;gBAAE,MAAM,EAAE,SAAS;;;YAEtC,UAAU,EAAE,IAAI;;IAExB,CAAC;WAEM,OAAO;AAChB,CAAC"}