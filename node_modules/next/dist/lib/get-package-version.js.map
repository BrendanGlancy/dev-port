{"version":3,"sources":["../../lib/get-package-version.ts"],"sourcesContent":["import { promises as fs } from 'fs'\nimport findUp from 'next/dist/compiled/find-up'\nimport JSON5 from 'next/dist/compiled/json5'\nimport * as path from 'path'\n\ntype PackageJsonDependencies = {\n  dependencies: Record<string, string>\n  devDependencies: Record<string, string>\n}\n\nlet cachedDeps: PackageJsonDependencies\n\nasync function getDependencies({\n  cwd,\n}: {\n  cwd: string\n}): Promise<PackageJsonDependencies> {\n  if (cachedDeps) {\n    return cachedDeps\n  }\n\n  const configurationPath: string | undefined = await findUp('package.json', {\n    cwd,\n  })\n  if (!configurationPath) {\n    return (cachedDeps = { dependencies: {}, devDependencies: {} })\n  }\n\n  const content = await fs.readFile(configurationPath, 'utf-8')\n  const packageJson: any = JSON5.parse(content)\n\n  const { dependencies = {}, devDependencies = {} } = packageJson || {}\n  return (cachedDeps = { dependencies, devDependencies })\n}\n\nexport async function getPackageVersion({\n  cwd,\n  name,\n}: {\n  cwd: string\n  name: string\n}): Promise<string | null> {\n  const { dependencies, devDependencies } = await getDependencies({ cwd })\n  if (!(dependencies[name] || devDependencies[name])) {\n    return null\n  }\n\n  const cwd2 =\n    cwd.endsWith(path.posix.sep) || cwd.endsWith(path.win32.sep)\n      ? cwd\n      : `${cwd}/`\n\n  try {\n    const targetPath = require.resolve(`${name}/package.json`, {\n      paths: [cwd2],\n    })\n    const targetContent = await fs.readFile(targetPath, 'utf-8')\n    return JSON5.parse(targetContent).version ?? null\n  } catch {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;QAmCsB,iBAAiB,GAAjB,iBAAiB;AAnCR,GAAI,CAAJ,GAAI;AAChB,GAA4B,CAA5B,OAA4B;AAC7B,GAA0B,CAA1B,MAA0B;AAChC,GAAI,CAAJ,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOhB,GAAG,CAAC,UAAU;eAEC,eAAe,GAC5B,GAAG,KAGgC,CAAC;IACpC,EAAE,EAAE,UAAU,EAAE,CAAC;eACR,UAAU;IACnB,CAAC;IAED,KAAK,CAAC,iBAAiB,aApBN,OAA4B,WAoBc,YAAc;QACvE,GAAG;;IAEL,EAAE,GAAG,iBAAiB,EAAE,CAAC;eACf,UAAU;YAAK,YAAY;;YAAM,eAAe;;;IAC1D,CAAC;IAED,KAAK,CAAC,OAAO,SA5BgB,GAAI,UA4BR,QAAQ,CAAC,iBAAiB,GAAE,KAAO;IAC5D,KAAK,CAAC,WAAW,GA3BD,MAA0B,SA2BX,KAAK,CAAC,OAAO;IAE5C,KAAK,GAAG,YAAY;QAAO,eAAe;WAAU,WAAW;;WACvD,UAAU;QAAK,YAAY;QAAE,eAAe;;AACtD,CAAC;eAEqB,iBAAiB,GACrC,GAAG,GACH,IAAI,KAIqB,CAAC;IAC1B,KAAK,GAAG,YAAY,GAAE,eAAe,YAAW,eAAe;QAAG,GAAG;;IACrE,EAAE,IAAI,YAAY,CAAC,IAAI,KAAK,eAAe,CAAC,IAAI,IAAI,CAAC;eAC5C,IAAI;IACb,CAAC;IAED,KAAK,CAAC,IAAI,GACR,GAAG,CAAC,QAAQ,CA7CJ,IAAI,CA6CM,KAAK,CAAC,GAAG,KAAK,GAAG,CAAC,QAAQ,CA7CpC,IAAI,CA6CsC,KAAK,CAAC,GAAG,IACvD,GAAG,MACA,GAAG,CAAC,CAAC;QAEV,CAAC;QACH,KAAK,CAAC,UAAU,GAAG,OAAO,CAAC,OAAO,IAAI,IAAI,CAAC,aAAa;YACtD,KAAK;gBAAG,IAAI;;;QAEd,KAAK,CAAC,aAAa,SAxDQ,GAAI,UAwDA,QAAQ,CAAC,UAAU,GAAE,KAAO;YACpD,QAAkC;gBAAlC,QAAkC,GAvD3B,MAA0B,SAuD3B,KAAK,CAAC,aAAa,EAAE,OAAO,cAAlC,QAAkC,cAAlC,QAAkC,GAAI,IAAI;IACnD,CAAC,QAAO,CAAC;eACA,IAAI;IACb,CAAC;AACH,CAAC"}