{"version":3,"sources":["../../server/image-optimizer.ts"],"sourcesContent":["import { mediaType } from '@hapi/accept'\nimport { createHash } from 'crypto'\nimport { createReadStream, promises } from 'fs'\nimport { getOrientation, Orientation } from 'get-orientation'\nimport { IncomingMessage, ServerResponse } from 'http'\n// @ts-ignore no types for is-animated\nimport isAnimated from 'next/dist/compiled/is-animated'\nimport { join } from 'path'\nimport Stream from 'stream'\nimport nodeUrl, { UrlWithParsedQuery } from 'url'\nimport { NextConfig } from './config-shared'\nimport { fileExists } from '../lib/file-exists'\nimport { ImageConfig, imageConfigDefault } from './image-config'\nimport { processBuffer, Operation } from './lib/squoosh/main'\nimport Server from './next-server'\nimport { sendEtagResponse } from './send-payload'\nimport { getContentType, getExtension } from './serve-static'\nimport chalk from 'chalk'\n\n//const AVIF = 'image/avif'\nconst WEBP = 'image/webp'\nconst PNG = 'image/png'\nconst JPEG = 'image/jpeg'\nconst GIF = 'image/gif'\nconst SVG = 'image/svg+xml'\nconst CACHE_VERSION = 3\nconst MODERN_TYPES = [/* AVIF, */ WEBP]\nconst ANIMATABLE_TYPES = [WEBP, PNG, GIF]\nconst VECTOR_TYPES = [SVG]\nconst BLUR_IMG_SIZE = 8 // should match `next-image-loader`\nconst inflightRequests = new Map<string, Promise<undefined>>()\n\nlet sharp:\n  | ((\n      input?: string | Buffer,\n      options?: import('sharp').SharpOptions\n    ) => import('sharp').Sharp)\n  | undefined\n\ntry {\n  sharp = require(process.env.NEXT_SHARP_PATH || 'sharp')\n} catch (e) {\n  // Sharp not present on the server, Squoosh fallback will be used\n}\n\nlet shouldShowSharpWarning = process.env.NODE_ENV === 'production'\n\nexport async function imageOptimizer(\n  server: Server,\n  req: IncomingMessage,\n  res: ServerResponse,\n  parsedUrl: UrlWithParsedQuery,\n  nextConfig: NextConfig,\n  distDir: string,\n  isDev = false\n) {\n  const imageData: ImageConfig = nextConfig.images || imageConfigDefault\n  const {\n    deviceSizes = [],\n    imageSizes = [],\n    domains = [],\n    loader,\n    minimumCacheTTL = 60,\n  } = imageData\n\n  if (loader !== 'default') {\n    await server.render404(req, res, parsedUrl)\n    return { finished: true }\n  }\n\n  const { headers } = req\n  const { url, w, q } = parsedUrl.query\n  const mimeType = getSupportedMimeType(MODERN_TYPES, headers.accept)\n  let href: string\n\n  if (!url) {\n    res.statusCode = 400\n    res.end('\"url\" parameter is required')\n    return { finished: true }\n  } else if (Array.isArray(url)) {\n    res.statusCode = 400\n    res.end('\"url\" parameter cannot be an array')\n    return { finished: true }\n  }\n\n  let isAbsolute: boolean\n\n  if (url.startsWith('/')) {\n    href = url\n    isAbsolute = false\n  } else {\n    let hrefParsed: URL\n\n    try {\n      hrefParsed = new URL(url)\n      href = hrefParsed.toString()\n      isAbsolute = true\n    } catch (_error) {\n      res.statusCode = 400\n      res.end('\"url\" parameter is invalid')\n      return { finished: true }\n    }\n\n    if (!['http:', 'https:'].includes(hrefParsed.protocol)) {\n      res.statusCode = 400\n      res.end('\"url\" parameter is invalid')\n      return { finished: true }\n    }\n\n    if (!domains.includes(hrefParsed.hostname)) {\n      res.statusCode = 400\n      res.end('\"url\" parameter is not allowed')\n      return { finished: true }\n    }\n  }\n\n  if (!w) {\n    res.statusCode = 400\n    res.end('\"w\" parameter (width) is required')\n    return { finished: true }\n  } else if (Array.isArray(w)) {\n    res.statusCode = 400\n    res.end('\"w\" parameter (width) cannot be an array')\n    return { finished: true }\n  }\n\n  if (!q) {\n    res.statusCode = 400\n    res.end('\"q\" parameter (quality) is required')\n    return { finished: true }\n  } else if (Array.isArray(q)) {\n    res.statusCode = 400\n    res.end('\"q\" parameter (quality) cannot be an array')\n    return { finished: true }\n  }\n\n  // Should match output from next-image-loader\n  const isStatic = url.startsWith('/_next/static/image')\n\n  const width = parseInt(w, 10)\n\n  if (!width || isNaN(width)) {\n    res.statusCode = 400\n    res.end('\"w\" parameter (width) must be a number greater than 0')\n    return { finished: true }\n  }\n\n  const sizes = [...deviceSizes, ...imageSizes]\n\n  if (isDev) {\n    sizes.push(BLUR_IMG_SIZE)\n  }\n\n  if (!sizes.includes(width)) {\n    res.statusCode = 400\n    res.end(`\"w\" parameter (width) of ${width} is not allowed`)\n    return { finished: true }\n  }\n\n  const quality = parseInt(q)\n\n  if (isNaN(quality) || quality < 1 || quality > 100) {\n    res.statusCode = 400\n    res.end('\"q\" parameter (quality) must be a number between 1 and 100')\n    return { finished: true }\n  }\n\n  const hash = getHash([CACHE_VERSION, href, width, quality, mimeType])\n  const imagesDir = join(distDir, 'cache', 'images')\n  const hashDir = join(imagesDir, hash)\n  const now = Date.now()\n\n  // If there're concurrent requests hitting the same resource and it's still\n  // being optimized, wait before accessing the cache.\n  if (inflightRequests.has(hash)) {\n    await inflightRequests.get(hash)\n  }\n  let dedupeResolver: (val?: PromiseLike<undefined>) => void\n  inflightRequests.set(\n    hash,\n    new Promise((resolve) => (dedupeResolver = resolve))\n  )\n\n  try {\n    if (await fileExists(hashDir, 'directory')) {\n      const files = await promises.readdir(hashDir)\n      for (let file of files) {\n        const [maxAgeStr, expireAtSt, etag, extension] = file.split('.')\n        const maxAge = Number(maxAgeStr)\n        const expireAt = Number(expireAtSt)\n        const contentType = getContentType(extension)\n        const fsPath = join(hashDir, file)\n        if (now < expireAt) {\n          const result = setResponseHeaders(\n            req,\n            res,\n            url,\n            etag,\n            maxAge,\n            contentType,\n            isStatic,\n            isDev\n          )\n          if (!result.finished) {\n            createReadStream(fsPath).pipe(res)\n          }\n          return { finished: true }\n        } else {\n          await promises.unlink(fsPath)\n        }\n      }\n    }\n\n    let upstreamBuffer: Buffer\n    let upstreamType: string | null\n    let maxAge: number\n\n    if (isAbsolute) {\n      const upstreamRes = await fetch(href)\n\n      if (!upstreamRes.ok) {\n        res.statusCode = upstreamRes.status\n        res.end('\"url\" parameter is valid but upstream response is invalid')\n        return { finished: true }\n      }\n\n      res.statusCode = upstreamRes.status\n      upstreamBuffer = Buffer.from(await upstreamRes.arrayBuffer())\n      upstreamType =\n        detectContentType(upstreamBuffer) ||\n        upstreamRes.headers.get('Content-Type')\n      maxAge = getMaxAge(upstreamRes.headers.get('Cache-Control'))\n    } else {\n      try {\n        const resBuffers: Buffer[] = []\n        const mockRes: any = new Stream.Writable()\n\n        const isStreamFinished = new Promise(function (resolve, reject) {\n          mockRes.on('finish', () => resolve(true))\n          mockRes.on('end', () => resolve(true))\n          mockRes.on('error', () => reject())\n        })\n\n        mockRes.write = (chunk: Buffer | string) => {\n          resBuffers.push(Buffer.isBuffer(chunk) ? chunk : Buffer.from(chunk))\n        }\n        mockRes._write = (chunk: Buffer | string) => {\n          mockRes.write(chunk)\n        }\n\n        const mockHeaders: Record<string, string | string[]> = {}\n\n        mockRes.writeHead = (_status: any, _headers: any) =>\n          Object.assign(mockHeaders, _headers)\n        mockRes.getHeader = (name: string) => mockHeaders[name.toLowerCase()]\n        mockRes.getHeaders = () => mockHeaders\n        mockRes.getHeaderNames = () => Object.keys(mockHeaders)\n        mockRes.setHeader = (name: string, value: string | string[]) =>\n          (mockHeaders[name.toLowerCase()] = value)\n        mockRes.removeHeader = (name: string) => {\n          delete mockHeaders[name.toLowerCase()]\n        }\n        mockRes._implicitHeader = () => {}\n        mockRes.connection = res.connection\n        mockRes.finished = false\n        mockRes.statusCode = 200\n\n        const mockReq: any = new Stream.Readable()\n\n        mockReq._read = () => {\n          mockReq.emit('end')\n          mockReq.emit('close')\n          return Buffer.from('')\n        }\n\n        mockReq.headers = req.headers\n        mockReq.method = req.method\n        mockReq.url = href\n        mockReq.connection = req.connection\n\n        await server.getRequestHandler()(\n          mockReq,\n          mockRes,\n          nodeUrl.parse(href, true)\n        )\n        await isStreamFinished\n        res.statusCode = mockRes.statusCode\n\n        upstreamBuffer = Buffer.concat(resBuffers)\n        upstreamType =\n          detectContentType(upstreamBuffer) || mockRes.getHeader('Content-Type')\n        maxAge = getMaxAge(mockRes.getHeader('Cache-Control'))\n      } catch (err) {\n        res.statusCode = 500\n        res.end('\"url\" parameter is valid but upstream response is invalid')\n        return { finished: true }\n      }\n    }\n\n    const expireAt = Math.max(maxAge, minimumCacheTTL) * 1000 + now\n\n    if (upstreamType) {\n      const vector = VECTOR_TYPES.includes(upstreamType)\n      const animate =\n        ANIMATABLE_TYPES.includes(upstreamType) && isAnimated(upstreamBuffer)\n      if (vector || animate) {\n        await writeToCacheDir(\n          hashDir,\n          upstreamType,\n          maxAge,\n          expireAt,\n          upstreamBuffer\n        )\n        sendResponse(\n          req,\n          res,\n          url,\n          maxAge,\n          upstreamType,\n          upstreamBuffer,\n          isStatic,\n          isDev\n        )\n        return { finished: true }\n      }\n\n      if (!upstreamType.startsWith('image/')) {\n        res.statusCode = 400\n        res.end(\"The requested resource isn't a valid image.\")\n        return { finished: true }\n      }\n    }\n\n    let contentType: string\n\n    if (mimeType) {\n      contentType = mimeType\n    } else if (\n      upstreamType?.startsWith('image/') &&\n      getExtension(upstreamType)\n    ) {\n      contentType = upstreamType\n    } else {\n      contentType = JPEG\n    }\n    try {\n      let optimizedBuffer: Buffer | undefined\n      if (sharp) {\n        // Begin sharp transformation logic\n        const transformer = sharp(upstreamBuffer)\n\n        transformer.rotate()\n\n        const { width: metaWidth } = await transformer.metadata()\n\n        if (metaWidth && metaWidth > width) {\n          transformer.resize(width)\n        }\n\n        if (contentType === WEBP) {\n          transformer.webp({ quality })\n        } else if (contentType === PNG) {\n          transformer.png({ quality })\n        } else if (contentType === JPEG) {\n          transformer.jpeg({ quality })\n        }\n\n        optimizedBuffer = await transformer.toBuffer()\n        // End sharp transformation logic\n      } else {\n        // Show sharp warning in production once\n        if (shouldShowSharpWarning) {\n          console.warn(\n            chalk.yellow.bold('Warning: ') +\n              `For production Image Optimization with Next.js, the optional 'sharp' package is strongly recommended. Run 'yarn add sharp', and Next.js will use it automatically for Image Optimization.\\n` +\n              'Read more: https://nextjs.org/docs/messages/sharp-missing-in-production'\n          )\n          shouldShowSharpWarning = false\n        }\n\n        // Begin Squoosh transformation logic\n        const orientation = await getOrientation(upstreamBuffer)\n\n        const operations: Operation[] = []\n\n        if (orientation === Orientation.RIGHT_TOP) {\n          operations.push({ type: 'rotate', numRotations: 1 })\n        } else if (orientation === Orientation.BOTTOM_RIGHT) {\n          operations.push({ type: 'rotate', numRotations: 2 })\n        } else if (orientation === Orientation.LEFT_BOTTOM) {\n          operations.push({ type: 'rotate', numRotations: 3 })\n        } else {\n          // TODO: support more orientations\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          // const _: never = orientation\n        }\n\n        operations.push({ type: 'resize', width })\n\n        //if (contentType === AVIF) {\n        //} else\n        if (contentType === WEBP) {\n          optimizedBuffer = await processBuffer(\n            upstreamBuffer,\n            operations,\n            'webp',\n            quality\n          )\n        } else if (contentType === PNG) {\n          optimizedBuffer = await processBuffer(\n            upstreamBuffer,\n            operations,\n            'png',\n            quality\n          )\n        } else if (contentType === JPEG) {\n          optimizedBuffer = await processBuffer(\n            upstreamBuffer,\n            operations,\n            'jpeg',\n            quality\n          )\n        }\n\n        // End Squoosh transformation logic\n      }\n      if (optimizedBuffer) {\n        await writeToCacheDir(\n          hashDir,\n          contentType,\n          maxAge,\n          expireAt,\n          optimizedBuffer\n        )\n        sendResponse(\n          req,\n          res,\n          url,\n          maxAge,\n          contentType,\n          optimizedBuffer,\n          isStatic,\n          isDev\n        )\n      } else {\n        throw new Error('Unable to optimize buffer')\n      }\n    } catch (error) {\n      sendResponse(\n        req,\n        res,\n        url,\n        maxAge,\n        upstreamType,\n        upstreamBuffer,\n        isStatic,\n        isDev\n      )\n    }\n\n    return { finished: true }\n  } finally {\n    // Make sure to remove the hash in the end.\n    dedupeResolver!()\n    inflightRequests.delete(hash)\n  }\n}\n\nasync function writeToCacheDir(\n  dir: string,\n  contentType: string,\n  maxAge: number,\n  expireAt: number,\n  buffer: Buffer\n) {\n  await promises.mkdir(dir, { recursive: true })\n  const extension = getExtension(contentType)\n  const etag = getHash([buffer])\n  const filename = join(dir, `${maxAge}.${expireAt}.${etag}.${extension}`)\n  await promises.writeFile(filename, buffer)\n}\n\nfunction getFileNameWithExtension(\n  url: string,\n  contentType: string | null\n): string | void {\n  const [urlWithoutQueryParams] = url.split('?')\n  const fileNameWithExtension = urlWithoutQueryParams.split('/').pop()\n  if (!contentType || !fileNameWithExtension) {\n    return\n  }\n\n  const [fileName] = fileNameWithExtension.split('.')\n  const extension = getExtension(contentType)\n  return `${fileName}.${extension}`\n}\n\nfunction setResponseHeaders(\n  req: IncomingMessage,\n  res: ServerResponse,\n  url: string,\n  etag: string,\n  maxAge: number,\n  contentType: string | null,\n  isStatic: boolean,\n  isDev: boolean\n) {\n  res.setHeader('Vary', 'Accept')\n  res.setHeader(\n    'Cache-Control',\n    isStatic\n      ? 'public, max-age=315360000, immutable'\n      : `public, max-age=${isDev ? 0 : maxAge}, must-revalidate`\n  )\n  if (sendEtagResponse(req, res, etag)) {\n    // already called res.end() so we're finished\n    return { finished: true }\n  }\n  if (contentType) {\n    res.setHeader('Content-Type', contentType)\n  }\n\n  const fileName = getFileNameWithExtension(url, contentType)\n  if (fileName) {\n    res.setHeader('Content-Disposition', `inline; filename=\"${fileName}\"`)\n  }\n\n  res.setHeader('Content-Security-Policy', `script-src 'none'; sandbox;`)\n\n  return { finished: false }\n}\n\nfunction sendResponse(\n  req: IncomingMessage,\n  res: ServerResponse,\n  url: string,\n  maxAge: number,\n  contentType: string | null,\n  buffer: Buffer,\n  isStatic: boolean,\n  isDev: boolean\n) {\n  const etag = getHash([buffer])\n  const result = setResponseHeaders(\n    req,\n    res,\n    url,\n    etag,\n    maxAge,\n    contentType,\n    isStatic,\n    isDev\n  )\n  if (!result.finished) {\n    res.end(buffer)\n  }\n}\n\nfunction getSupportedMimeType(options: string[], accept = ''): string {\n  const mimeType = mediaType(accept, options)\n  return accept.includes(mimeType) ? mimeType : ''\n}\n\nfunction getHash(items: (string | number | Buffer)[]) {\n  const hash = createHash('sha256')\n  for (let item of items) {\n    if (typeof item === 'number') hash.update(String(item))\n    else {\n      hash.update(item)\n    }\n  }\n  // See https://en.wikipedia.org/wiki/Base64#Filenames\n  return hash.digest('base64').replace(/\\//g, '-')\n}\n\nfunction parseCacheControl(str: string | null): Map<string, string> {\n  const map = new Map<string, string>()\n  if (!str) {\n    return map\n  }\n  for (let directive of str.split(',')) {\n    let [key, value] = directive.trim().split('=')\n    key = key.toLowerCase()\n    if (value) {\n      value = value.toLowerCase()\n    }\n    map.set(key, value)\n  }\n  return map\n}\n\n/**\n * Inspects the first few bytes of a buffer to determine if\n * it matches the \"magic number\" of known file signatures.\n * https://en.wikipedia.org/wiki/List_of_file_signatures\n */\nexport function detectContentType(buffer: Buffer) {\n  if ([0xff, 0xd8, 0xff].every((b, i) => buffer[i] === b)) {\n    return JPEG\n  }\n  if (\n    [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a].every(\n      (b, i) => buffer[i] === b\n    )\n  ) {\n    return PNG\n  }\n  if ([0x47, 0x49, 0x46, 0x38].every((b, i) => buffer[i] === b)) {\n    return GIF\n  }\n  if (\n    [0x52, 0x49, 0x46, 0x46, 0, 0, 0, 0, 0x57, 0x45, 0x42, 0x50].every(\n      (b, i) => !b || buffer[i] === b\n    )\n  ) {\n    return WEBP\n  }\n  if ([0x3c, 0x3f, 0x78, 0x6d, 0x6c].every((b, i) => buffer[i] === b)) {\n    return SVG\n  }\n  return null\n}\n\nexport function getMaxAge(str: string | null): number {\n  const map = parseCacheControl(str)\n  if (map) {\n    let age = map.get('s-maxage') || map.get('max-age') || ''\n    if (age.startsWith('\"') && age.endsWith('\"')) {\n      age = age.slice(1, -1)\n    }\n    const n = parseInt(age, 10)\n    if (!isNaN(n)) {\n      return n\n    }\n  }\n  return 0\n}\n\nexport async function resizeImage(\n  content: Buffer,\n  dimension: 'width' | 'height',\n  size: number,\n  extension: 'webp' | 'png' | 'jpeg',\n  quality: number\n): Promise<Buffer> {\n  if (sharp) {\n    const transformer = sharp(content)\n\n    if (extension === 'webp') {\n      transformer.webp({ quality })\n    } else if (extension === 'png') {\n      transformer.png({ quality })\n    } else if (extension === 'jpeg') {\n      transformer.jpeg({ quality })\n    }\n    if (dimension === 'width') {\n      transformer.resize(size)\n    } else {\n      transformer.resize(null, size)\n    }\n    const buf = await transformer.toBuffer()\n    return buf\n  } else {\n    const resizeOperationOpts: Operation =\n      dimension === 'width'\n        ? { type: 'resize', width: size }\n        : { type: 'resize', height: size }\n    const buf = await processBuffer(\n      content,\n      [resizeOperationOpts],\n      extension,\n      quality\n    )\n    return buf\n  }\n}\n"],"names":[],"mappings":"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"}